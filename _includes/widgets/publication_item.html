{% assign item = include.item %}
<div class="row my-2" style="overflow:hidden;">
  <!-- 图片及蓝色角标 -->
  <div class="col-sm-12 col-md-6 col-xl-6 abbr d-flex flex-column align-items-center justify-content-center" style="position:relative;overflow:hidden;width:450px;max-width:100%;padding:0;">
    <div style="position:absolute;top:6px;left:6px;z-index:2;">
      <abbr class="badge" style="background-color:#00369f;color:#fff;font-size:14px;padding:4px 12px;border-radius:4px;box-shadow:0 1px 6px rgba(0,0,0,.12);">IJCV</abbr>
    </div>
    <a href="{{ item.img_link }}" target="_blank" style="display:block;width:500px;height:150px;overflow:hidden;border-radius:6px;box-shadow:0 0px 10px rgba(0,0,0,0.15);">
      <img src="{{ item.cover }}" alt="{{ item.title }}" style="width:500px;height:150px;object-fit:cover;transition:transform .3s cubic-bezier(.4,0,.2,1);border-radius:6px;" class="hover-zoom-img">
    </a>
    <style>
      .hover-zoom-img:hover { transform:scale(1.08);}
    </style>
  </div>
  <!-- 右侧信息 -->
  <div class="col-sm-12 col-md-6 col-xl-6 d-flex flex-column justify-content-between">
    <div>
      <div class="title" style="font-size:1.18rem;font-weight:500;">{{ item.title }}</div>
      <div class="author mb-1"><em>{% include widgets/author_list.html authors=item.authors %}</em></div>
      <div class="periodical mb-1"><em>{{ item.pub_pre }}<b>{{ item.pub }}</b>{{ item.pub_post }}, {{ item.pub_date }}{{ item.pub_last }}</em></div>
    </div>
    <div class="d-flex flex-row flex-wrap align-items-center gap-1 mt-2 links">
      <button class="award btn btn-sm z-depth-0 px-3 py-1 mx-1" type="button" style="background:#f5f5fa;"
        onclick="toggleAbs('{{ item.id }}');">ABSTRACT</button>
      <a href="{{ item.pdf_link }}" class="btn btn-sm z-depth-0 px-3 py-1 mx-1" target="_blank" style="background:#f5f5fa;">PDF</a>
      <button class="bibtex btn btn-sm z-depth-0 px-3 py-1 mx-1" type="button"
        onclick="toggleBib('{{ item.id }}');">BIB</button>
      <a href="{{ item.html_link }}" class="btn btn-sm z-depth-0 px-3 py-1 mx-1" target="_blank" style="background:#f5f5fa;">HTML</a>
      <a href="{{ item.code_link }}" class="btn btn-sm z-depth-0 px-3 py-1 mx-1" target="_blank" style="background:#f5f5fa;">CODE</a>
    </div>
    <!-- ABSTRACT 展开区（全宽 col-12） -->
    <div id="abs{{ item.id }}" class="row mt-2 d-none">
      <div class="col-12" style="padding-left:0;">
        <div style="background:#f9f9fb;font-size:15px;padding:10px 16px;border-radius:4px;">
          {{ item.abstract }}
        </div>
      </div>
    </div>
    <!-- BIB 展开区（半宽 col-6），含复制按钮 -->
    <div id="bib{{ item.id }}" class="row mt-2 d-none">
      <div class="col-6" style="position:relative;">
        <pre class="mb-0" style="background:#f9f9fb;border-radius:4px;padding:10px 16px;font-size:14px;overflow:auto;" id="bib-content-{{ item.id }}">{{ item.bibtex }}</pre>
        <button type="button" class="btn btn-link p-0 position-absolute" style="top:7px;right:18px;" 
            title="复制" aria-label="Copy"
            onclick="copyBibToClipboard('{{ item.id }}')">
          <i class="fa fa-clipboard"></i>
        </button>
        <!-- 复制成功提示 -->
        <span id="bib-copied-{{ item.id }}" class="text-success" style="display:none;position:absolute;top:7px;right:58px;">已复制!</span>
      </div>
    </div>
  </div>
</div>


<script>
// ABSTRACT 和 BIB 互斥展开
function toggleAbs(id) {
  var absBox = document.getElementById('abs'+id);
  var bibBox = document.getElementById('bib'+id);
  if (absBox.classList.contains('d-none')) {
    absBox.classList.remove('d-none');
    bibBox.classList.add('d-none');
  } else {
    absBox.classList.add('d-none');
  }
}
function toggleBib(id) {
  var bibBox = document.getElementById('bib'+id);
  var absBox = document.getElementById('abs'+id);
  if (bibBox.classList.contains('d-none')) {
    bibBox.classList.remove('d-none');
    absBox.classList.add('d-none');
  } else {
    bibBox.classList.add('d-none');
  }
}

// 复制功能
function copyBibToClipboard(id) {
  var pre = document.getElementById('bib-content-' + id);
  var text = pre.innerText;
  navigator.clipboard.writeText(text).then(function() {
    var tip = document.getElementById('bib-copied-' + id);
    tip.style.display = 'inline';
    setTimeout(function() { tip.style.display = 'none'; }, 1400);
  });
}
</script>
